<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tic Tac Attack</title>
    <style>
      /* Todo o CSS permanece igual */
      :root {
        --primary-color: #007bff;
        --secondary-color: #66b3ff;
        --background-dark: #121212;
        --background-light: #f5f5f5;
        --text-light: #ffffff;
        --text-dark: #333333;
        --cell-bg: #1e1e1e;
        --cell-border: #333;
        --x-color: #ff4d4d;
        --o-color: #4d94ff;
        --glow-color: rgba(0, 123, 255, 0.6);
      }

      .light-theme {
        --background-dark: #f5f5f5;
        --background-light: #ffffff;
        --text-light: #333333;
        --text-dark: #121212;
        --cell-bg: #e0e0e0;
        --cell-border: #cccccc;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(
          135deg,
          var(--background-dark),
          var(--background-light)
        );
        color: var(--text-light);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        padding: 20px;
      }

      .container {
        max-width: 800px;
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
      }

      header {
        text-align: center;
        margin-bottom: 20px;
      }

      h1 {
        font-size: 3rem;
        margin-bottom: 10px;
        background: linear-gradient(
          90deg,
          var(--primary-color),
          var(--secondary-color)
        );
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        text-shadow: 0 0 10px var(--glow-color);
      }

      .subtitle {
        font-size: 1.2rem;
        color: var(--text-light);
        opacity: 0.8;
      }

      .screen {
        width: 100%;
        background: rgba(30, 30, 30, 0.8);
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        transition: all 0.3s ease;
      }

      #main-menu {
        display: flex;
      }

      #game-screen,
      #settings-screen,
      #custom-screen {
        display: none;
      }

      #ad-screen {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 100;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      .menu-buttons {
        display: flex;
        flex-direction: column;
        gap: 15px;
        width: 100%;
        max-width: 300px;
      }

      button {
        padding: 15px 25px;
        border: none;
        border-radius: 8px;
        background: linear-gradient(
          90deg,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
        font-size: 1.1rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      button.secondary-btn {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      button:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      }

      button:active {
        transform: translateY(1px);
      }

      .game-info {
        display: flex;
        justify-content: space-between;
        width: 100%;
        max-width: 400px;
        margin-bottom: 10px;
      }

      .player-info {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px 20px;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.1);
      }

      .player-info.active {
        background: rgba(106, 17, 203, 0.3);
        box-shadow: 0 0 15px var(--glow-color);
      }

      .game-board {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        grid-gap: 10px;
        max-width: 400px;
        width: 100%;
        margin: 0 auto;
        position: relative;
      }

      .cell {
        aspect-ratio: 1;
        background: var(--cell-bg);
        border: 2px solid var(--cell-border);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.15s ease;
        position: relative;
        overflow: hidden;
      }

      .cell:hover {
        background: rgba(255, 255, 255, 0.06);
      }

      .cell.x {
        color: var(--x-color);
        text-shadow: 0 0 10px rgba(255, 77, 77, 0.7);
      }

      .cell.o {
        color: var(--o-color);
        text-shadow: 0 0 10px rgba(77, 148, 255, 0.7);
      }

      .attack-mode-active {
        animation: pulse 1.5s infinite;
        box-shadow: 0 0 30px rgba(255, 80, 80, 0.25);
      }

      @keyframes pulse {
        0% {
          box-shadow: 0 0 10px rgba(255, 80, 80, 0.2);
        }
        50% {
          box-shadow: 0 0 40px rgba(255, 80, 80, 0.35);
        }
        100% {
          box-shadow: 0 0 10px rgba(255, 80, 80, 0.2);
        }
      }

      .spark {
        position: absolute;
        width: 4px;
        height: 4px;
        background-color: #ffcc00;
        border-radius: 50%;
        pointer-events: none;
        z-index: 10;
      }

      @keyframes spark-fly {
        0% {
          transform: translate(0, 0);
          opacity: 1;
        }
        100% {
          transform: translate(var(--tx), var(--ty));
          opacity: 0;
        }
      }

      .settings-option {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        max-width: 400px;
        margin-bottom: 15px;
      }

      .toggle-switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
      }

      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 34px;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }

      input:checked + .slider {
        background: linear-gradient(
          90deg,
          var(--primary-color),
          var(--secondary-color)
        );
      }

      input:checked + .slider:before {
        transform: translateX(26px);
      }

      .color-picker {
        display: flex;
        gap: 10px;
        margin-top: 10px;
      }

      .color-option {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        border: 2px solid transparent;
      }

      .color-option.selected {
        border: 2px solid white;
        box-shadow: 0 0 10px white;
      }

      #x-color-1 {
        background: #ff4d4d;
      }
      #x-color-2 {
        background: #ffcc00;
      }
      #x-color-3 {
        background: #00cc66;
      }
      #x-color-4 {
        background: #ff9900;
      }
      #x-color-5 {
        background: #00ffff;
      }
      #x-color-6 {
        background: #ffffff;
      }

      #o-color-1 {
        background: #4d94ff;
      }
      #o-color-2 {
        background: #cc66ff;
      }
      #o-color-3 {
        background: #ff66b3;
      }
      #o-color-4 {
        background: #00ff99;
      }
      #o-color-5 {
        background: #ff33cc;
      }
      #o-color-6 {
        background: #ffff00;
      }

      #board-color-1 {
        background: #1e1e1e;
      }
      #board-color-2 {
        background: #2d2d2d;
      }
      #board-color-3 {
        background: #3d3d3d;
      }
      #board-color-4 {
        background: #000000;
      }
      #board-color-5 {
        background: #222244;
      }
      #board-color-6 {
        background: #444400;
      }

      .cell:active {
        transform: scale(0.96);
        transition: transform 0.1s ease;
      }

      .message {
        font-size: 1.2rem;
        text-align: center;
        margin-top: 10px;
        min-height: 30px;
      }

      .attack-message {
        color: #ff4d4d;
        font-weight: bold;
        animation: flash 1s infinite;
      }

      .effect-message {
        color: #00ff99;
        font-weight: bold;
        animation: glow 1s infinite;
      }

      @keyframes flash {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      @keyframes glow {
        0%,
        100% {
          text-shadow: 0 0 5px #00ff99;
        }
        50% {
          text-shadow: 0 0 20px #00ff99, 0 0 30px #00ff99;
        }
      }

      #ad-content {
        text-align: center;
        max-width: 500px;
        padding: 30px;
        background: rgba(30, 30, 30, 0.9);
        border-radius: 15px;
        box-shadow: 0 0 30px rgba(106, 17, 203, 0.5);
      }

      #ad-timer {
        font-size: 2rem;
        margin: 20px 0;
        color: var(--secondary-color);
      }

      @media (max-width: 600px) {
        h1 {
          font-size: 2.5rem;
        }
        .game-board {
          max-width: 300px;
        }
        .cell {
          font-size: 2.5rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Tic Tac Attack</h1>
        <div class="subtitle">Classic Tic Tac Toe with Attack Mode!</div>
      </header>

      <div id="main-menu" class="screen">
        <div class="menu-buttons">
          <button id="play-btn">Play</button>
          <button id="settings-btn" class="secondary-btn">Settings</button>
          <button id="custom-btn" class="secondary-btn">Customize</button>
          <button id="exit-btn" class="secondary-btn">Exit</button>
        </div>
      </div>

      <div id="game-screen" class="screen">
        <div class="game-info">
          <div class="player-info active" id="player-info">
            <div>Player (X)</div>
            <div id="player-moves">Moves: 0</div>
          </div>
          <div class="player-info" id="computer-info">
            <div>Computer (O)</div>
            <div id="computer-moves">Moves: 0</div>
          </div>
        </div>

        <div class="game-board" id="game-board"></div>

        <div class="message" id="game-message">
          Your turn! Click on a cell to place X
        </div>

        <div class="menu-buttons">
          <button id="restart-btn">Restart</button>
          <button id="menu-btn" class="secondary-btn">Main Menu</button>
        </div>
      </div>

      <div id="settings-screen" class="screen">
        <h2>Settings</h2>
        <div class="settings-option">
          <span>Sound</span>
          <label class="toggle-switch">
            <input type="checkbox" id="sound-toggle" checked />
            <span class="slider"></span>
          </label>
        </div>
        <div class="settings-option">
          <span>Dark Theme</span>
          <label class="toggle-switch">
            <input type="checkbox" id="theme-toggle" checked />
            <span class="slider"></span>
          </label>
        </div>
        <div class="menu-buttons">
          <button id="settings-back-btn">Back</button>
        </div>
      </div>

      <div id="custom-screen" class="screen">
        <h2>Customize</h2>
        <div class="settings-option">
          <span>X Color</span>
          <div class="color-picker">
            <div class="color-option selected" id="x-color-1"></div>
            <div class="color-option" id="x-color-2"></div>
            <div class="color-option" id="x-color-3"></div>
            <div class="color-option" id="x-color-4"></div>
            <div class="color-option" id="x-color-5"></div>
            <div class="color-option" id="x-color-6"></div>
          </div>
        </div>
        <div class="settings-option">
          <span>O Color</span>
          <div class="color-picker">
            <div class="color-option selected" id="o-color-1"></div>
            <div class="color-option" id="o-color-2"></div>
            <div class="color-option" id="o-color-3"></div>
            <div class="color-option" id="o-color-4"></div>
            <div class="color-option" id="o-color-5"></div>
            <div class="color-option" id="o-color-6"></div>
          </div>
        </div>
        <div class="settings-option">
          <span>Board Color</span>
          <div class="color-picker">
            <div class="color-option selected" id="board-color-1"></div>
            <div class="color-option" id="board-color-2"></div>
            <div class="color-option" id="board-color-3"></div>
            <div class="color-option" id="board-color-4"></div>
            <div class="color-option" id="board-color-5"></div>
            <div class="color-option" id="board-color-6"></div>
          </div>
        </div>
        <div class="menu-buttons">
          <button id="custom-back-btn">Back</button>
        </div>
      </div>

      <div id="ad-screen">
        <div id="ad-content">
          <h2>Advertisement</h2>
          <p>Thank you for playing! This is a simulated ad.</p>
          <div id="ad-timer">5</div>
          <p>The game will continue automatically...</p>
        </div>
      </div>
    </div>

    <script>
      // Game State
      let board = Array(9).fill("");
      let currentPlayer = "X";
      let gameActive = false;
      let playerMoves = 0;
      let computerMoves = 0;
      let playerAttackMode = false;
      let computerAttackMode = false;
      let matchesPlayed = 0;

      let firstPlayerXIndex = -1;
      let firstComputerOIndex = -1;
      let playerStartsNext = true;

      // Settings
      let soundEnabled = true;
      let darkTheme = true;
      let xColor = "#ff4d4d";
      let oColor = "#4d94ff";
      let boardColor = "#1e1e1e";

      // Sound System
      const audioContext = new (window.AudioContext ||
        window.webkitAudioContext)();

      function playSound(frequency, duration, type = "sine") {
        if (!soundEnabled) return;

        try {
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();

          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);

          oscillator.frequency.value = frequency;
          oscillator.type = type;

          gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            audioContext.currentTime + duration
          );

          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + duration);
        } catch (e) {
          console.log("Audio error:", e);
        }
      }

      const sounds = {
        click: () => playSound(800, 0.1),
        place: () => playSound(600, 0.2),
        win: () => playSound(523, 0.5),
        lose: () => playSound(220, 0.5),
        draw: () => playSound(440, 0.3),
        attack: () => playSound(1200, 0.3, "square"),
        spark: () => playSound(1500, 0.1, "sawtooth"),
        error: () => playSound(300, 0.2, "square"),
        powerup: () => {
          playSound(800, 0.1);
          setTimeout(() => playSound(1000, 0.1), 100);
          setTimeout(() => playSound(1200, 0.1), 200);
        },
      };

      // DOM Elements
      const elements = {
        mainMenu: document.getElementById("main-menu"),
        gameScreen: document.getElementById("game-screen"),
        settingsScreen: document.getElementById("settings-screen"),
        customScreen: document.getElementById("custom-screen"),
        adScreen: document.getElementById("ad-screen"),
        gameBoard: document.getElementById("game-board"),
        gameMessage: document.getElementById("game-message"),
        playerMovesDisplay: document.getElementById("player-moves"),
        computerMovesDisplay: document.getElementById("computer-moves"),
        playerInfo: document.getElementById("player-info"),
        computerInfo: document.getElementById("computer-info"),
        adTimer: document.getElementById("ad-timer"),
      };

      // Initialization
      function initGame() {
        createBoard();
        setupEventListeners();
        applyTheme();
        applyCustomColors();
      }

      function createBoard() {
        elements.gameBoard.innerHTML = "";
        for (let i = 0; i < 9; i++) {
          const cell = document.createElement("div");
          cell.classList.add("cell");
          cell.dataset.index = i;
          cell.addEventListener("click", () => handleCellClick(i));
          cell.addEventListener("touchend", (e) => {
            e.preventDefault();
            handleCellClick(i);
          });
          elements.gameBoard.appendChild(cell);
        }
      }

      function setupEventListeners() {
        document
          .getElementById("play-btn")
          .addEventListener("click", startGame);
        document
          .getElementById("settings-btn")
          .addEventListener("click", showSettings);
        document
          .getElementById("custom-btn")
          .addEventListener("click", showCustom);
        document.getElementById("exit-btn").addEventListener("click", exitGame);
        document
          .getElementById("restart-btn")
          .addEventListener("click", restartGame);
        document
          .getElementById("menu-btn")
          .addEventListener("click", showMainMenu);
        document
          .getElementById("settings-back-btn")
          .addEventListener("click", showMainMenu);
        document
          .getElementById("sound-toggle")
          .addEventListener("change", toggleSound);
        document
          .getElementById("theme-toggle")
          .addEventListener("change", toggleTheme);
        document
          .getElementById("custom-back-btn")
          .addEventListener("click", showMainMenu);

        document
          .querySelectorAll(".color-option")
          .forEach((opt) =>
            opt.addEventListener("click", handleColorSelection)
          );
      }

      // Game Functions
      function startGame() {
        resetGame();
        elements.mainMenu.style.display = "none";
        elements.gameScreen.style.display = "flex";
        gameActive = true;

        currentPlayer = playerStartsNext ? "X" : "O";
        playerStartsNext = !playerStartsNext;

        if (currentPlayer === "X") {
          updateGameMessage("Your turn! Click on a cell to place X");
        } else {
          updateGameMessage("Computer starts...");
          setTimeout(computerMove, 800);
        }
      }

      function resetGame() {
        board = Array(9).fill("");
        playerMoves = 0;
        computerMoves = 0;
        playerAttackMode = false;
        computerAttackMode = false;
        firstPlayerXIndex = -1;
        firstComputerOIndex = -1;
        updateMovesDisplay();
        updatePlayerIndicators();
        resetBoardUI();
        elements.gameBoard.classList.remove("attack-mode-active");
        elements.gameMessage.classList.remove("attack-message");
      }

      function resetBoardUI() {
        document.querySelectorAll(".cell").forEach((cell) => {
          cell.textContent = "";
          cell.classList.remove("x", "o");
        });
      }

      function handleCellClick(index) {
        if (!gameActive || currentPlayer !== "X") return;

        if (playerAttackMode) {
          if (board[index] === "X") {
            showEffectMessage("Cannot replace your own piece!");
            sounds.error();
            return;
          }
        } else {
          if (board[index] !== "") {
            showEffectMessage("Cell already occupied!");
            sounds.error();
            return;
          }

          if (firstPlayerXIndex === -1) {
            firstPlayerXIndex = index;
          }
        }

        placeMark(index, "X");
        playerMoves++;
        updateMovesDisplay();
        sounds.place();

        if (
          playerAttackMode &&
          firstPlayerXIndex !== -1 &&
          firstPlayerXIndex !== index
        ) {
          clearFirstMove(firstPlayerXIndex, "player");
          firstPlayerXIndex = -1;
        }

        if (checkWin()) {
          endGame("X");
          return;
        }
        if (checkDraw()) {
          endGame("draw");
          return;
        }

        currentPlayer = "O";
        updatePlayerIndicators();
        updateGameMessage("Computer's turn...");
        setTimeout(computerMove, 700);
      }

      function computerMove() {
        if (!gameActive || currentPlayer !== "O") return;

        let moveIndex;
        let availableMoves = [];

        if (computerAttackMode) {
          for (let i = 0; i < 9; i++) {
            if (board[i] !== "O") {
              availableMoves.push(i);
            }
          }
        } else {
          availableMoves = board
            .map((v, i) => (v === "" ? i : null))
            .filter((v) => v !== null);

          if (firstComputerOIndex === -1 && availableMoves.length > 0) {
            firstComputerOIndex = availableMoves[0];
          }
        }

        moveIndex = findWinningMove("O");
        if (moveIndex === -1) moveIndex = findWinningMove("X");
        if (moveIndex === -1) {
          moveIndex =
            availableMoves[Math.floor(Math.random() * availableMoves.length)];
        }

        placeMark(moveIndex, "O");
        computerMoves++;
        updateMovesDisplay();
        sounds.place();

        if (
          computerAttackMode &&
          firstComputerOIndex !== -1 &&
          firstComputerOIndex !== moveIndex
        ) {
          clearFirstMove(firstComputerOIndex, "computer");
          firstComputerOIndex = -1;
        }

        if (checkWin()) {
          endGame("O");
          return;
        }
        if (checkDraw()) {
          endGame("draw");
          return;
        }

        currentPlayer = "X";
        updatePlayerIndicators();
        updateGameMessage("Your turn! Click on a cell to place X");

        checkAttackMode();
      }

      function clearFirstMove(index, player) {
        if (index < 0 || index > 8) return;
        board[index] = "";
        const cell = document.querySelector(`.cell[data-index="${index}"]`);
        if (cell) {
          cell.textContent = "";
          cell.classList.remove("x", "o");
          createSparkEffect(cell);
          showEffectMessage(
            `${
              player === "player" ? "Your" : "Computer's"
            } first piece vanished!`
          );
          sounds.spark();
        }
      }

      function createSparkEffect(cellElement) {
        for (let i = 0; i < 10; i++) {
          let spark = document.createElement("div");
          spark.classList.add("spark");

          const rect = cellElement.getBoundingClientRect();
          const x = rect.left + Math.random() * rect.width;
          const y = rect.top + Math.random() * rect.height;

          spark.style.left = `${x}px`;
          spark.style.top = `${y}px`;

          const tx = (Math.random() - 0.5) * 100;
          const ty = (Math.random() - 0.5) * 100;
          spark.style.setProperty("--tx", `${tx}px`);
          spark.style.setProperty("--ty", `${ty}px`);

          document.body.appendChild(spark);

          spark.animate(
            [
              { transform: "translate(0, 0)", opacity: 1 },
              { transform: `translate(${tx}px, ${ty}px)`, opacity: 0 },
            ],
            {
              duration: 500 + Math.random() * 500,
              easing: "cubic-bezier(0.1, 0.8, 0.2, 1)",
            }
          ).onfinish = () => spark.remove();
        }
      }

      function placeMark(index, player) {
        board[index] = player;
        const cell = document.querySelector(`.cell[data-index="${index}"]`);
        if (cell) {
          cell.textContent = player;
          cell.classList.remove("x", "o");
          cell.classList.add(player.toLowerCase());

          cell.style.transform = "scale(0.8)";
          setTimeout(() => {
            cell.style.transform = "scale(1)";
          }, 150);
        }
      }

      function findWinningMove(player) {
        const wins = [
          [0, 1, 2],
          [3, 4, 5],
          [6, 7, 8],
          [0, 3, 6],
          [1, 4, 7],
          [2, 5, 8],
          [0, 4, 8],
          [2, 4, 6],
        ];
        for (const [a, b, c] of wins) {
          const line = [board[a], board[b], board[c]];
          if (line.filter((v) => v === player).length === 2) {
            const empty = [a, b, c].find((i) => board[i] === "");
            if (empty !== undefined) return empty;
          }
        }
        return -1;
      }

      function checkWin() {
        const wins = [
          [0, 1, 2],
          [3, 4, 5],
          [6, 7, 8],
          [0, 3, 6],
          [1, 4, 7],
          [2, 5, 8],
          [0, 4, 8],
          [2, 4, 6],
        ];
        return wins.some(
          ([a, b, c]) =>
            board[a] && board[a] === board[b] && board[a] === board[c]
        );
      }

      function checkDraw() {
        return board.every((cell) => cell !== "");
      }

      function checkAttackMode() {
        if (
          playerMoves >= 3 &&
          computerMoves >= 3 &&
          !playerAttackMode &&
          !computerAttackMode
        ) {
          activateAttackMode();
        }
      }

      function endGame(winner) {
        gameActive = false;
        if (winner === "X") {
          updateGameMessage("🎉 You win!");
          sounds.win();
          showEffectMessage("Victory! Excellent strategy!");
        } else if (winner === "O") {
          updateGameMessage("😢 Computer wins!");
          sounds.lose();
          showEffectMessage("Better luck next time!");
        } else {
          updateGameMessage("😐 Draw!");
          sounds.draw();
          showEffectMessage("It's a tie! Well played!");
        }

        matchesPlayed++;

        if (matchesPlayed % 3 === 0) {
          setTimeout(showAd, 1000);
        }
      }

      function activateAttackMode() {
        playerAttackMode = true;
        computerAttackMode = true;
        elements.gameBoard.classList.add("attack-mode-active");
        updateGameMessage(
          "⚔️ ATTACK MODE ACTIVATED! You can now play on opponent's cells."
        );
        sounds.powerup();
        showEffectMessage("ATTACK MODE! Pieces can be replaced!");
        elements.gameMessage.classList.add("attack-message");
      }

      function showEffectMessage(msg) {
        const effectMsg = document.createElement("div");
        effectMsg.className = "message effect-message";
        effectMsg.textContent = msg;
        effectMsg.style.fontSize = "1rem";
        effectMsg.style.marginTop = "5px";
        effectMsg.style.opacity = "0";

        elements.gameMessage.parentNode.insertBefore(
          effectMsg,
          elements.gameMessage.nextSibling
        );

        setTimeout(() => {
          effectMsg.style.transition = "opacity 0.5s";
          effectMsg.style.opacity = "1";
        }, 100);

        setTimeout(() => {
          effectMsg.style.opacity = "0";
          setTimeout(() => {
            if (effectMsg.parentNode) {
              effectMsg.parentNode.removeChild(effectMsg);
            }
          }, 500);
        }, 2000);
      }

      function showAd() {
        elements.adScreen.style.display = "flex";
        let countdown = 5;
        elements.adTimer.textContent = countdown;
        const timer = setInterval(() => {
          countdown--;
          elements.adTimer.textContent = countdown;
          if (countdown <= 0) {
            clearInterval(timer);
            elements.adScreen.style.display = "none";
          }
        }, 1000);
      }

      function updateMovesDisplay() {
        elements.playerMovesDisplay.textContent = `Moves: ${playerMoves}`;
        elements.computerMovesDisplay.textContent = `Moves: ${computerMoves}`;
      }

      function updatePlayerIndicators() {
        if (currentPlayer === "X") {
          elements.playerInfo.classList.add("active");
          elements.computerInfo.classList.remove("active");
        } else {
          elements.computerInfo.classList.add("active");
          elements.playerInfo.classList.remove("active");
        }
      }

      function updateGameMessage(msg) {
        elements.gameMessage.textContent = msg;
        if (!msg.toLowerCase().includes("attack")) {
          elements.gameMessage.classList.remove("attack-message");
        }
      }

      function restartGame() {
        resetGame();
        gameActive = true;
        updateGameMessage("New game started!");
        showEffectMessage("Game reset! Good luck!");
        if (!playerStartsNext) setTimeout(computerMove, 800);
      }

      function showMainMenu() {
        elements.mainMenu.style.display = "flex";
        elements.gameScreen.style.display = "none";
        elements.settingsScreen.style.display = "none";
        elements.customScreen.style.display = "none";
        elements.adScreen.style.display = "none";
      }

      function showSettings() {
        elements.mainMenu.style.display = "none";
        elements.settingsScreen.style.display = "flex";
        document.getElementById("sound-toggle").checked = soundEnabled;
        document.getElementById("theme-toggle").checked = darkTheme;
      }

      function showCustom() {
        elements.mainMenu.style.display = "none";
        elements.customScreen.style.display = "flex";
      }

      function exitGame() {
        alert("Thank you for playing Tic Tac Attack!");
      }

      function toggleSound() {
        soundEnabled = document.getElementById("sound-toggle").checked;
        if (soundEnabled) {
          if (audioContext.state === "suspended") {
            audioContext.resume();
          }
          sounds.click();
        }
      }

      function toggleTheme() {
        darkTheme = document.getElementById("theme-toggle").checked;
        applyTheme();
      }

      function applyTheme() {
        if (darkTheme) {
          document.body.classList.remove("light-theme");
        } else {
          document.body.classList.add("light-theme");
        }
      }

      function handleColorSelection(e) {
        const option = e.target;
        const id = option.id;
        const group = id.split("-")[0];

        option.parentElement
          .querySelectorAll(".color-option")
          .forEach((o) => o.classList.remove("selected"));
        option.classList.add("selected");

        const color = getComputedStyle(option).backgroundColor;
        if (group === "x") {
          xColor = color;
          document.documentElement.style.setProperty("--x-color", xColor);
        } else if (group === "o") {
          oColor = color;
          document.documentElement.style.setProperty("--o-color", oColor);
        } else if (group === "board") {
          boardColor = color;
          document.documentElement.style.setProperty("--cell-bg", boardColor);
        }

        sounds.click();
      }

      function applyCustomColors() {
        document.documentElement.style.setProperty("--x-color", xColor);
        document.documentElement.style.setProperty("--o-color", oColor);
        document.documentElement.style.setProperty("--cell-bg", boardColor);
      }

      // Initialize game
      window.addEventListener("DOMContentLoaded", initGame);
    </script>
  </body>
</html>
